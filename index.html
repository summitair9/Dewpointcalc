<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DewPoint</title>

  <!-- Tailwind & Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />

  <!-- React + Babel (JSX without build step) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Fonts & Styles -->
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap");
    body {
      font-family: "Inter", sans-serif;
      background-color: #0f172a;
      color: #f8fafc;
      overflow-x: hidden;
      min-height: 100vh;
    }
    .glass {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .glow-text {
      text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
    }
    input[type="range"] {
      -webkit-appearance: none;
      background: rgba(255, 255, 255, 0.1);
      height: 6px;
      border-radius: 5px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: #38bdf8;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(56, 189, 248, 0.8);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- REACT APPLICATION -->
  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    const TemperatureUnit = { CELSIUS: "C", FAHRENHEIT: "F" };

    /* ---- Conversions ---- */
    const c2f = c => Math.round(((c * 9) / 5 + 32) * 10) / 10;
    const f2c = f => Math.round(((f - 32) * 5) / 9 * 10) / 10;

    /* ---- Dewpoint ---- */
    function dewpointC(T, RH) {
      const b = 17.67, c = 243.5;
      const g = Math.log(RH / 100) + (b * T) / (c + T);
      return Math.round(((c * g) / (b - g)) * 10) / 10;
    }

    /* ---- Comfort bands ---- */
    function comfort(dewC) {
      if (dewC < 10) return { label:'Dry & Crisp', color:'text-sky-400', level:0 };
      if (dewC < 15) return { label:'Pleasant', color:'text-emerald-400', level:1 };
      if (dewC < 18) return { label:'Comfortable', color:'text-teal-400', level:2 };
      if (dewC < 21) return { label:'Humid', color:'text-yellow-400', level:3 };
      if (dewC < 24) return { label:'Uncomfortable', color:'text-orange-500', level:4 };
      return { label:'Oppressive', color:'text-red-500', level:5 };
    }

    /* ---- Simple AI-ish wording ---- */
    function describe(temp, hum, dew, unit) {
      const u="°"+unit;
      if(hum<30) return `Crisp, dry air at ${temp}${u}.`;
      if(hum<45) return `Clean and balanced air around ${temp}${u}.`;
      if(hum<60) return `Soft humidity wraps at ${temp}${u}.`;
      if(hum<75) return `Warm, clinging air at ${temp}${u}.`;
      return `Heavy, saturated air pressing at ${temp}${u}.`;
    }

    /* ---- DB/WB to RH & evap SAT ---- */
    function dbwb(db, wb) {
      const D=parseFloat(db), W=parseFloat(wb);
      if(isNaN(D)||isNaN(W)||W>D) return null;
      const T=(D-32)*(5/9), Tw=(W-32)*(5/9);
      const A=0.00066*101.3;
      const esTw=6.112*Math.exp((17.67*Tw)/(Tw+243.5));
      const e=esTw-A*(T-Tw);
      const esT=6.112*Math.exp((17.67*T)/(T+243.5));
      const RH=Math.max(0,Math.min(100,100*(e/esT)));
      const dC=dewpointC(T,RH), dF=c2f(dC);
      let coil=dF-15; coil=Math.max(32,Math.min(55,coil));
      return {rh:RH, dewC:dC, dewF:dF, coilF:coil};
    }

    function App(){
      /* ---- DEFAULTS now Fahrenheit ---- */
      const [unit,setUnit]=useState(TemperatureUnit.FAHRENHEIT);
      const [tempF,setTempF]=useState(72);
      const [rh,setRh]=useState(50);

      const tempC = useMemo(()=>unit==="F"?f2c(tempF):tempF,[unit,tempF]);
      const dewC  = useMemo(()=>dewpointC(tempC,rh),[tempC,rh]);
      const dewOut=unit==="F"?c2f(dewC):dewC;
      const com=comfort(dewC);

      const [txt,setTxt]=useState("Adjust fields…");
      const [load,setLoad]=useState(false);

      const getOut=(t,h,d)=>describe(t,h,d,unit);

      useEffect(()=>{
        setLoad(true);
        const tm=setTimeout(()=>{
          setTxt(getOut(tempF,rh,dewOut));
          setLoad(false);
        },300);
        return()=>clearTimeout(tm);
      },[tempF,rh,unit]);

      const switchUnit=()=> {
        if(unit==="F"){ setUnit("C"); setTempF(f2c(tempF)); }
        else{ setUnit("F"); setTempF(c2f(tempC)); }
      };

      return(
        <div className="p-8 text-center">
          <h1 className="text-4xl mb-6">DEWPOINT</h1>

          {/* Temp slider */}
          <div className="mb-6">
            <div className="text-3xl mb-2">
              {unit==="F"?tempF:tempC.toFixed(1)}
              <span className="text-sky-400">°</span>{unit}
            </div>
            <button
              onClick={switchUnit}
              className="px-4 py-2 bg-white/10 rounded-xl border border-white/10 text-xs mb-2"
            >
              Switch to °{unit==="F"?"C":"F"}
            </button>
            <input
              type="range"
              min={unit==="F"?"-4":"-20"}
              max={unit==="F"?"122":"50"}
              step="0.5"
              value={unit==="F"?tempF:tempC}
              onChange={e=>setTempF(unit==="F"?parseFloat(e.target.value):c2f(parseFloat(e.target.value)))}
              className="w-full"
            />
          </div>

          {/* Humidity */}
          <div className="mb-6">
            <div className="text-3xl mb-2">
              {rh}<span className="text-sky-400">%</span>
            </div>
            <input type="range" min="0" max="100" step="1"
              value={rh}
              onChange={e=>setRh(parseFloat(e.target.value))}
              className="w-full"
            />
          </div>

          {/* Dewpoint */}
          <div className="text-6xl font-bold mb-2 glow-text">
            {dewOut}<span className="text-sky-400">°</span>
          </div>
          <div className={`text-xl ${com.color} mb-6`}>{com.label}</div>

          <div className="italic">{load?"…thinking":txt}</div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
